:import ".."
:import "../../../spec/mare/micro_test"

:actor Main
  :new (env)
    test = MicroTest.new(env)
    test.print_line_break // TODO: move to MicroTest constructor and finalizer
    
    ///
    // Map methods
    
    map = Map(String, U64, HashEq(String)).new // TODO: implicit default for HashFunction type argument
    test["Map size empty      "].pass = map.size == 0
    test["Map []! missing key "].pass = try (map["example"]!, False | True)
    test["Map []= return value"].pass = (map["example"] = 99) == 99
    test["Map size == 1       "].pass = map.size == 1
    test["Map []! found key   "].pass = try (map["example"]! | U64[0]) == 99
    test["Map []= again       "].pass = (map["example"] = 88) == 88
    test["Map size == 1 still "].pass = map.size == 1
    test["Map []! found again "].pass = try (map["example"]! | U64[0]) == 88
    test["Map delete          "].pass = map.delete("example") <: None
    test["Map []! gone again  "].pass = try map["example"]! <: None
    test["Map size == 0 again "].pass = map.size == 0
    
    map_each = Map(String, U64, HashEq(String)).new // TODO: implicit default for HashFunction type argument
    map_each_copy = Map(String, U64, HashEq(String)).new // TODO: implicit default for HashFunction type argument
    map_each["foo"] = 11
    map_each["bar"] = 22
    map_each["baz"] = 33
    map_each.each -> (key, value | map_each_copy[key] = value)
    test["Map each, [foo]"].pass = try (map_each_copy["foo"]! | U64[0]) == 11
    test["Map each, [bar]"].pass = try (map_each_copy["bar"]! | U64[0]) == 22
    test["Map each, [baz]"].pass = try (map_each_copy["baz"]! | U64[0]) == 33
    
    test.print_line_break // TODO: move to MicroTest constructor and finalizer
