:class MicroTest
  :prop env Env
  :new (@env)
  :fun print_line_break: Print.line_break
  :fun "[]" (text String) MicroTestInstance
    MicroTestInstance.new(@env, text)

:class MicroTestInstance
  :prop env Env
  :prop text String
  :new (@env, @text)
  :fun "pass=" (pass Bool)
    if pass (
      Print.f("%s", ".")
    |
      Print.line_break // TODO: fix processing of \n in string literals and use it
      Print.f("failure of '%s'!", @text)
      Print.line_break // TODO: fix processing of \n in string literals and use it
      @env.exit_code = 1 // Mark the entire process as a failure.
    )

:primitive Print
  :fun line_break
    LibC.puts("".cpointer)
  
  :fun f (format String, text String)
    LibC.printf(format.cpointer, text.cpointer)

:ffi LibC
  :fun puts (CPointer(U8)) I32
  :fun printf (CPointer(U8), CPointer(U8)) I32
